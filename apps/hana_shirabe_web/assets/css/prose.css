/* 用户生成内容的 HTML 样式设计。*/

/* Phoenix 使用的是 TailwindCSS-Standalone，
  那几十兆（现在是一百多兆了）中就正好包括了一些常见的插件，引入即可。
**/
@plugin "@tailwindcss/typography";


/* 告诉 Tailwind v4 自己生成类名 */
@utility text-muted {
  color: var(--color-muted);
}

@utility text-muted-foreground {
  color: var(--color-muted-foreground);
}


/* Type-scale */
@theme {
  /* Modular scale based on 1.25 (Major Third) */
  --ts-0: 1.0625rem;
  --ts-1: 1.25rem;
  --ts-2: 1.563rem;
  --ts-3: 1.953rem;
  --ts-4: 2.441rem;
  --ts-5: 3.052rem;


  /* Line-height tuned for CJK */
  --lh-tight: 1.28;
  --lh-normal: 1.7;
  --lh-relaxed: 1.8;
}


/*
  这里原来是 @utility prose { ... } ...
  但因为之前排错时 Grok 建议用 @layer components { .prose { ... } ... }
  所以就改成了这样（所以严格来讲不知道是不是这里的问题）。

  ChatGPT 也认同这种写法，因为typography 是 component-level 的存在，如此操作更好。

  另外关于响应式，GPT 的方案是做容器级响应式，形如：

  `<div class="prose max-w-none lg:max-w-3xl xl:max-w-4xl ..."> ... </div>`
*/
@layer components {
  .prose {
    --tw-prose-body: var(--color-primary);
    --tw-prose-headings: var(--color-primary);
    --tw-prose-bold: var(--color-primary);
    --tw-prose-quote-borders: var(--color-slate-300);
    --tw-prose-quotes: var(--color-muted-foreground);

    /* 不需要代码前后的引号 */
    code {
      &::before,
      &::after {
        display: none;
      }
    }

    /* 不需要引用前后的引号 */
    blockquote p {
      &:first-of-type::before,
      &:last-of-type::after {
        display: none;
      }
    }

    blockquote {
      font-weight: 400;
      @apply border-l-4 pl-4 italic my-4;
    }

    /* 段落节奏 */
    p {
      @apply my-2 leading-relaxed;
    }

    h1 {
      font-size: var(--ts-4); /* text-3xl */
      @apply mt-10 mb-4 leading-snug;
    }
    h2 {
      font-size: var(--ts-3); /* text-2xl */
      @apply mt-8 mb-3 leading-snug;
    }
    h3 {
      font-size: var(--ts-2); /* text-xl */
      @apply mt-6 mb-2 leading-snug;
    }
    h4 {
      font-size: var(--ts-1); /* text-lg */
      @apply mt-4 mb-2 leading-snug;
    }

    ul,
    ol {
      @apply my-3;
    }

    li {
      @apply my-1;
    }

    p, li {
      font-size: var(--ts-0);
      line-height: var(--lh-normal);
    }

    /* 图片、图注 */
    figure {
      @apply my-6 text-center;
    }

    figcaption {
      @apply text-sm text-muted-foreground mt-2;
    }

    /* 表格 */
    table {
      @apply w-full my-6 border-collapse border border-slate-300 text-sm;
    }
    th,
    td {
      @apply border border-slate-300 px-3 py-2;
    }
    th {
      @apply bg-slate-100 font-semibold;
    }

    /* 脚注结构 */
    .footnotes {
      @apply mt-10 pt-4 border-t text-sm text-muted-foreground;
    }
    .footnote-ref {
      @apply text-sm align-super;
    }

    /* 限制行宽（typography 基础） */
    max-width: 72ch;
    font-size: 1rem;
    line-height: 1.75;
  }

  /**
  以下部分将对各个主题进行设计。

  目前考虑三类：

   * non-UGC
      主要用于系统生成内容，如帮助文档、系统公告、技术博客等。
      字体（标题）选择 ChillDIN 等无衬线体字体系列；
      TBD.
   * "archaiologia"（UGC - 人文主义）
      * 名字由来：希腊语的"考古学"（ἀρχαιολογία），意为"对古代事物的研究"。
      * 字体选择 LessWrong 等论坛的风格，主要是 Alegreya, Merriweather, Palatino, Garamond,
        Baskerville, Libre Baskerville, Georgia 字体系列，以及思源宋体的衬线体（后期会进行调整）。
        * 标题用 non-serif，粗体/强调用黑体/non-serif，其他正文用宋体/serif。 
      * 一般用于长篇文章，后期甚至会适配学术写作的部分功能。
      * 计划借鉴 `heti` 的样式以及此前的个人博客（采用 `hexo-theme-yuzu`）
   * "minimalism"（UGC - 简洁主义）
      * 一般用于随笔、讨论等社交交流属性大于内容属性的场景。

  此外还有导出等场景，但目前不在讨论范围内（"archaiologia" 用
    "KingHwa Old Song" 等打印机的字体）。
  **/

  /* ======================================================================== */
  /*  non-UGC（系统内容、公告、帮助文档）                                     */
  /* ======================================================================== */

  [data-theme="non-ugc"] .prose {
    font-family: var(--font-content-sans);

    --tw-prose-body: var(--color-foreground);
    --tw-prose-headings: var(--color-foreground);

    h1,
    h2,
    h3,
    h4 {
      @apply font-bold tracking-tight;
    }

    max-width: 70ch;
  }

  /* ======================================================================== */
  /*  archaiologia（人文色彩长文，类似 LessWrong + Heti）                     */
  /* ======================================================================== */

  [data-theme="archaiologia"] .prose {
    /* 正文 serif */
    font-family: var(--font-content-serif);
    font-size: 1.05rem;
    line-height: 1.85;
    max-width: 72ch;

    /* 行间距更文学 */
    p {
      @apply leading-relaxed;
    }

    /* 标题改为 sans-serif */
    h1,
    h2,
    h3,
    h4 {
      font-family: var(--font-content-sans);
      @apply tracking-wide font-semibold;
    }

    /* 强调也改用 sans-serif */
    strong {
      font-family: var(--font-content-sans);
      @apply font-semibold;
    }

    /* blockquote 更文学 */
    blockquote {
      @apply border-l-4 pl-4 italic my-6;

      color: var(--color-muted-foreground);
    }

    /* 列表更宽松 */
    ul,
    ol {
      @apply my-4;
    }
  }

  /* ======================================================================== */
  /*  minimalism（随笔、讨论、轻量 UGC）                                      */
  /* ======================================================================== */

  [data-theme="minimalism"] .prose {
    font-family: var(--font-content-sans);
    font-size: 1rem;
    line-height: 1.7;
    max-width: 65ch;

    h1,
    h2,
    h3,
    h4 {
      @apply font-medium tracking-tight;
    }

    ul,
    ol {
      @apply my-1;
    }

    blockquote {
      @apply border-l-2 pl-3 italic;
    }
  }
}
